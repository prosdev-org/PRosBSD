add_custom_command(
        OUTPUT MBR.BIN
        COMMAND ${CMAKE_ASM_COMPILER} ${CMAKE_ASM_FLAGS} -c ${CMAKE_CURRENT_SOURCE_DIR}/src/mbr.S -o ${CMAKE_CURRENT_BINARY_DIR}/mbr.o
        COMMAND ${CMAKE_LINKER} ${CMAKE_LINKER_FLAGS} -Ttext 0x7C00 -o ${CMAKE_CURRENT_BINARY_DIR}/MBR.BIN ${CMAKE_CURRENT_BINARY_DIR}/mbr.o
        COMMAND ${CMAKE_OBJCOPY} ${CMAKE_OBJCOPY_FLAGS} ${CMAKE_CURRENT_BINARY_DIR}/MBR.BIN
        COMMENT "Building MBR (stage 1) of fd.img"
)

add_custom_command(
        OUTPUT SETUP.BIN
        COMMAND ln -sf ${CMAKE_CURRENT_SOURCE_DIR}/FONT.FNT ${CMAKE_CURRENT_BINARY_DIR}/FONT.FNT
        COMMAND ${CMAKE_ASM_COMPILER} ${CMAKE_ASM_FLAGS} -c ${CMAKE_CURRENT_SOURCE_DIR}/src/setup.S -o ${CMAKE_CURRENT_BINARY_DIR}/setup.o
        COMMAND ${CMAKE_LINKER} ${CMAKE_LINKER_FLAGS} -Ttext 0x0600 -o ${CMAKE_CURRENT_BINARY_DIR}/SETUP.BIN ${CMAKE_CURRENT_BINARY_DIR}/setup.o
        COMMAND ${CMAKE_OBJCOPY} ${CMAKE_OBJCOPY_FLAGS} ${CMAKE_CURRENT_BINARY_DIR}/SETUP.BIN
        COMMENT "Building setup (stage 2) of fd.img"
)

add_custom_target(boot
        DEPENDS MBR.BIN
        DEPENDS SETUP.BIN
)
